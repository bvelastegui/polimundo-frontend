<template>
  <v-card :loading="loading">
    <v-toolbar>
      <v-toolbar-title>Encuentra tu vuelo</v-toolbar-title>
    </v-toolbar>
    <v-form @submit.prevent="redirectToResults">
      <v-container>
        <v-row>
          <v-col
              cols="12"
              md="6"
              lg="3"
          >
            <v-autocomplete
                v-model="origin"
                :items="airports"
                filled
                :disabled="loading"
                label="Ciudad de origen"
                item-value="code"
                item-text="code"
            >
              <template v-slot:selection="{ item }">
                {{ item.city }} - {{ item.country }} ({{ item.code }})
              </template>
              <template v-slot:item="{ item }">
                {{ item.city }} - {{ item.country }} ({{ item.code }})
              </template>
            </v-autocomplete>
          </v-col>
          <v-col
              cols="12"
              md="6"
              lg="3"
          >
            <v-autocomplete
                v-model="destination"
                :items="airports"
                filled
                :disabled="loading"
                label="Ciudad de destino"
                item-value="code"
                item-text="code"
            >
              <template v-slot:selection="{ item }">
                {{ item.city }} - {{ item.country }} ({{ item.code }})
              </template>
              <template v-slot:item="{ item }">
                {{ item.city }} - {{ item.country }} ({{ item.code }})
              </template>
            </v-autocomplete>
          </v-col>
          <v-col
              cols="12"
              md="6"
              lg="3"
          >
            <v-menu
                v-model="depart_date_menu"
                :close-on-content-click="false"
                transition="scale-transition"
                offset-y
                max-width="290px"
                min-width="290px"
            >
              <template v-slot:activator="{ on }">
                <v-text-field
                    color="#3A1C71"
                    filled
                    readonly
                    :disabled="loading"
                    append-icon="mdi-calendar"
                    label="Fecha de partida"
                    v-on="on"
                    :value="depart_date"
                ></v-text-field>
              </template>
              <v-date-picker
                  v-model="depart_date"
                  no-title
                  @input="depart_date_menu = false"
              ></v-date-picker>
            </v-menu>
          </v-col>
          <v-col
              cols="12"
              md="6"
              lg="3"
          >
            <v-menu
                v-model="return_date_menu"
                :close-on-content-click="false"
                transition="scale-transition"
                offset-y
                max-width="290px"
                min-width="290px"
            >
              <template v-slot:activator="{ on }">
                <v-text-field
                    :value="return_date"
                    color="#3A1C71"
                    filled
                    :disabled="loading"
                    append-icon="mdi-calendar"
                    label="Fecha de retorno"
                    v-on="on"
                ></v-text-field>
              </template>
              <v-date-picker
                  v-model="return_date"
                  :min="depart_date"
                  no-title
                  @input="return_date_menu = false"
              ></v-date-picker>
            </v-menu>
          </v-col>
        </v-row>
        <v-row>
          <v-col
              cols="12"
              md="3"
              offset-md="9"
              lg="2"
              offset-lg="10"
          >
            <v-fab-transition>
              <v-btn
                  block
                  dark
                  color="#3A1C71"
                  elevation="2"
                  type="submit"
              >
                Buscar
              </v-btn>
            </v-fab-transition>
          </v-col>
        </v-row>
      </v-container>
    </v-form>
  </v-card>
</template>
<script>
import {mapActions, mapState} from 'vuex'

export default {
  data: () => ({
    loading: true,
    depart_date_menu: false,
    return_date_menu: false,
  }),

  computed: {
    origin: {
      get() {
        return this.$store.state.search.origin
      },
      set(value) {
        this.choseOrigin(value)
      }
    },
    destination: {
      get() {
        return this.$store.state.search.destination
      },
      set(value) {
        this.choseDestination(value)
      }
    },
    depart_date: {
      get() {
        return this.$store.state.search.depart_date
      },
      set(value) {
        this.$store.commit('search/setDepartDate', value)
      }
    },
    return_date: {
      get() {
        return this.$store.state.search.return_date
      },
      set(value) {
        this.$store.commit('search/setReturnDate', value)
      }
    },
    ...mapState({
      airports: state => state.search.airports
    }),
  },

  methods: {
    ...mapActions({
      choseOrigin: 'search/choseOrigin',
      choseDestination: 'search/choseDestination'
    }),
    redirectToResults() {
      this.$router.push('flights')
    }
  },

  async created() {
    await this.$store.dispatch('search/getAllAirports')
    this.loading = false
  }
}
</script>